# BaseOpenSDK(Node.js)
## æ¦‚è¿°
[é£ä¹¦å¼€æ”¾å¹³å°](https://open.feishu.cn/document/server-docs/docs/bitable-v1/bitable-overview)æä¾›äº†ä¸€ç³»åˆ—æœåŠ¡ç«¯çš„åŸå­apiæ¥å®ç°å¤šå…ƒåŒ–çš„åŠŸèƒ½ï¼Œä½†åœ¨å®é™…ç¼–ç è¿‡ç¨‹ä¸­æ„Ÿå—ä¸æ˜¯å¾ˆé¡ºç•…ï¼ŒåŸå› åœ¨äºä½¿ç”¨è¿™äº›apiå®ŒæˆåŠŸèƒ½æ—¶ï¼Œéœ€è¦è€ƒè™‘å¾ˆå¤šé¢å¤–çš„å·¥ä½œï¼Œå¦‚tokençš„è·å–åŠå…¶ç»´æŠ¤ã€æ•°æ®åŠ è§£å¯†ã€è¯·æ±‚çš„éªŒç­¾ç­‰ç­‰ï¼›å†è€…ï¼Œåœ¨å®é™…ç¼–ç è¿‡ç¨‹ä¸­ï¼Œå°‘äº†å‡½æ•°è°ƒç”¨çš„è¯­ä¹‰åŒ–æè¿°ï¼Œç±»å‹ç³»ç»Ÿçš„æ”¯æŒï¼Œä½¿å¾—å¿ƒæ™ºè´Ÿæ‹…è¿‡é‡ã€‚

å‡¡æ­¤ç§ç§ï¼Œéƒ½ä½¿å¾—æ•´ä½“çš„å¼€å‘ä½“éªŒä¸ä½³ï¼ŒåŸºäºæ­¤ï¼Œä¸ºäº†è®©å¼€æ”¾èƒ½åŠ›å˜å¾—æ˜“ç”¨ï¼Œæˆ‘ä»¬ç¼–å†™äº†è¯¥SDKï¼Œå°†æ‰€æœ‰å†—é•¿çš„é€»è¾‘å†…ç½®å¤„ç†ï¼Œæä¾›å®Œå¤‡çš„ç±»å‹ç³»ç»Ÿï¼Œå¯¹å¤–æä¾›è¯­ä¹‰åŒ–çš„ç¼–ç¨‹æ¥å£ï¼Œæé«˜ç¼–ç ä½“éªŒã€‚ğŸ˜™

## æ¦‚å¿µ
- å¼€å‘æ–‡æ¡£ï¼šå¼€æ”¾å¹³å°çš„å¼€æ”¾æ¥å£çš„å‚è€ƒï¼Œ**å¼€å‘è€…å¿…çœ‹ï¼Œå¯ä»¥ä½¿ç”¨æœç´¢åŠŸèƒ½ï¼Œé«˜æ•ˆçš„æŸ¥è¯¢æ–‡æ¡£**ã€‚[æ›´å¤šä»‹ç»è¯´æ˜](https://open.feishu.cn/document/server-docs/docs/bitable-v1/bitable-overview) ã€‚

## å®‰è£…
npm
```shell script
npm i -S https://lf3-static.bytednsdoc.com/obj/eden-cn/jjjpceh7nulojvhj/node-sdk-0.0.6.tgz
```

## å¦‚ä½•ä½¿ç”¨
æä¾›ECMAScriptï¼ŒCommonJS2ä¸ªç‰ˆæœ¬ï¼Œæ”¯æŒåŸç”ŸJavascriptå’ŒTypescriptçš„ä½¿ç”¨ï¼Œç¤ºä¾‹å‡ä»¥Typescriptä¸ºä¾‹ã€‚

SDKæä¾›äº†è¯­ä¹‰åŒ–çš„è°ƒç”¨æ–¹å¼ï¼Œåªéœ€è¦ä¾æ®ç›¸å…³å‚æ•°æ„é€ å‡ºclientå®ä¾‹ï¼Œæ¥ç€ä½¿ç”¨å…¶ä¸Šçš„è¯­ä¹‰åŒ–æ–¹æ³•ï¼ˆ*client.ä¸šåŠ¡åŸŸ.èµ„æº.æ–¹æ³•*ï¼‰å³å¯å®Œæˆapiè°ƒç”¨ï¼Œè°ƒç”¨è¿‡ç¨‹åŠè°ƒç”¨ç»“æœå‡æœ‰å®Œå¤‡çš„ç±»å‹è¿›è¡Œæç¤ºï¼Œå¦‚åˆ—å‡º Base æ•°æ®è¡¨è®°å½•ï¼š
```typescript
import { BaseClient } from '@lark-base-open/node-sdk';

// æ–°å»º BaseClientï¼Œè´´ä¸Šéœ€è¦æ“ä½œçš„ appToken å’Œ personalBaseToken
const client = new BaseClient({
  appToken: 'xxx',
  personalBaseToken: 'pt-xxxx'
});

// åˆ—å‡ºæ•°æ®è¡¨è®°å½•
const res = await client.base.appTableRecord.list({
  params: {
    page_size: 10,
  },
  path: {
    table_id: 'tblxxxxxx'
  }
});
```


#### `BaseClient`æ„é€ å‚æ•°ï¼š
|  å‚æ•°   | æè¿°  | ç±»å‹ | å¿…é¡» | é»˜è®¤ |
|  ----  | ----  | ---- | ---- | ---- |
| appToken  | Base åº”ç”¨å”¯ä¸€æ ‡è¯† | string | æ˜¯ | - |
| personalBaseToken  | Base åº”ç”¨ä¸ªäººçš„é‰´æƒ Tokenï¼Œä»ç½‘é¡µç«¯è·å– | string | æ˜¯ | - |
| domain  | åº”ç”¨çš„åŸŸï¼Œåˆ†ä¸ºé£ä¹¦ã€larkã€å…¶å®ƒï¼ˆéœ€è¦ä¼ é€’å®Œæ•´çš„åŸŸåï¼‰ | Domain &#124; string | å¦ | Domain.Feishu |
| httpInstance | sdkå‘é€è¯·æ±‚çš„httpå®ä¾‹ã€‚*sdkå†…éƒ¨é»˜è®¤ä½¿ç”¨axios.create()æ„é€ å‡ºä¸€ä¸ªdefaultHttpInstanceæ¥è¿›è¡Œhttpè°ƒç”¨ã€‚*| HttpInstance | å¦ | defaultHttpInstanceã€‚*å¯ä»¥ä»sdkä¸­importå®ƒï¼Œåœ¨å…¶ä¸Šæ·»åŠ interceptorsæ¥å®Œæˆä¸šåŠ¡éœ€æ±‚ã€‚* |
| loggerLevel  | æ—¥å¿—çº§åˆ« | LoggerLevel | å¦ | info |
| logger  | - | Logger | å¦ | - |

#### åˆ†é¡µ
é’ˆå¯¹è¿”å›å€¼ä»¥åˆ†é¡µå½¢å¼å‘ˆç°çš„æ¥å£ï¼Œå¯¹å…¶æä¾›äº†è¿­ä»£å™¨æ–¹å¼çš„å°è£…ï¼ˆæ–¹æ³•ååç¼€ä¸ºWithIteratorï¼‰ï¼Œæé«˜æ˜“ç”¨æ€§ï¼Œæ¶ˆå¼­äº†æ ¹æ®page_tokenæ¥åå¤è·å–æ•°æ®çš„ç¹çæ“ä½œï¼Œå¦‚è·å–æ•°æ®è¡¨è®°å½•åˆ—è¡¨ï¼š
``` typescript
// æ¯æ¬¡å¤„ç†20æ¡æ•°æ®
for await (const data of await client.base.appTableRecord.listWithIterator({
  params: {
    page_size: 20,
  },
  path: {
    table_id: TABLEID
  }
})) {
  console.log(data?.items);
}
```
*å½“ç„¶ä¹Ÿå¯ä»¥ä½¿ç”¨æ— è¿­ä»£å™¨å°è£…çš„ç‰ˆæœ¬ï¼Œè¿™æ—¶å€™éœ€è¦è‡ªå·±æ¯æ¬¡æ ¹æ®è¿”å›çš„page_tokenæ¥æ‰‹åŠ¨è¿›è¡Œåˆ†é¡µè°ƒç”¨ã€‚*
#### æ–‡ä»¶ä¸Šä¼ 
å’Œè°ƒç”¨æ™®é€šapiçš„æ–¹å¼ä¸€æ ·ï¼ŒæŒ‰ç±»å‹æç¤ºä¼ é€’å‚æ•°å³å¯ï¼Œå†…éƒ¨å°è£…äº†å¯¹æ–‡ä»¶ä¸Šä¼ çš„å¤„ç†ï¼Œå¦‚ï¼š
```typescript
const filePath = path.resolve(__dirname, 'file.jpeg')

const data = await client.drive.media.uploadAll({
  data: {
    file_name: 'file.png', // æ–‡ä»¶å
    parent_type: 'bitable_image', // bitable_image | bitable_file
    parent_node: client.appToken, // å¡«å†™ appToken
    size: fs.statSync(filePath).size, // æ–‡ä»¶å¤§å°
    file: fs.createReadStream(filePath), // æ–‡ä»¶æµ
  }
})
const fileToken = data.file_token;
```
#### æ–‡ä»¶ä¸‹è½½
å¯¹è¿”å›çš„äºŒè¿›åˆ¶æµè¿›è¡Œäº†å°è£…ï¼Œæ¶ˆå¼­äº†å¯¹æµæœ¬èº«çš„å¤„ç†ï¼Œåªéœ€è°ƒç”¨writeFileæ–¹æ³•å³å¯å°†æ•°æ®å†™å…¥æ–‡ä»¶ï¼Œå¦‚ï¼š
```typescript
const response = await client.drive.media.download({
  path: { file_token: 'xxx' },
  // å¦‚æœ Base å¼€å¯äº†é«˜çº§æƒé™ï¼Œåˆ™éœ€è¦å¡«å†™ extra å‚æ•°
  params: { extra: JSON.stringify({
    "bitablePerm": {
      "tableId": 'tblxxx', // èµ„æºæ‰€åœ¨æ•°æ®è¡¨ Id
      "attachments": {
        "fldxxxxxxx": { // èµ„æºæ‰€åœ¨æ•°æ®è¡¨å­—æ®µ Id
            "recxxxxxxx": [ // èµ„æºæ‰€åœ¨æ•°æ®è¡¨è®°å½• Id
              "xxx" // é™„ä»¶ file_token
            ]
        }
      }
    }
  }) }  
})
await response.writeFile(path.resolve(__dirname, 'file.png'));
```

#### æ™®é€šè°ƒç”¨
æŸäº›è€ç‰ˆæœ¬çš„å¼€æ”¾æ¥å£ï¼Œæ— æ³•ç”Ÿæˆå¯¹åº”çš„è¯­ä¹‰åŒ–è°ƒç”¨æ–¹æ³•ï¼Œéœ€è¦ä½¿ç”¨clientä¸Šçš„requestæ–¹æ³•æ¥è¿›è¡Œæ‰‹åŠ¨è°ƒç”¨ï¼š
```typescript
import { BaseClient } from 'base-open-sdk';

const client = new BaseClient({
  appToken: 'xxx',
  personalBaseToken: 'pt-xxx'
});

const res = await client.request({
  method: 'POST',
  url: 'xxx',
  data: {},
  params: {},
});
```

## è®¸å¯åè®®
MIT

